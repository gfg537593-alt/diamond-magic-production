<!doctype html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Diamond Magic โ Login / Signup</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="rtl">
  <main class="card">
    <h1>๐ Diamond Magic</h1>
    <p class="muted">ุจุฑุงู ฺฉุฑู ูุงฺฏ ุงูู ุง ุณุงุฆู ุงูพ ฺฉุฑฺบ</p>

    <section>
      <h3>ูุงฺฏ ุงูู</h3>
      <input id="loginEmail" type="email" placeholder="ุง ูู" />
      <input id="loginPassword" type="password" placeholder="ูพุงุณ ูุฑฺ" />
      <div class="row">
        <button id="loginBtn">ูุงฺฏ ุงูู</button>
        <button id="toSignup" class="ghost">ุณุงุฆู ุงูพ ูพุฑ ุฌุงุฆฺบ</button>
      </div>
    </section>

    <section style="margin-top:14px">
      <h3>ุณุงุฆู ุงูพ</h3>
      <input id="signupEmail" type="email" placeholder="ุง ูู" />
      <input id="signupPassword" type="password" placeholder="ูพุงุณ ูุฑฺ" />
      <div class="row">
        <button id="signupBtn">ุณุงุฆู ุงูพ</button>
      </div>
    </section>

    <p class="small muted">ุงุณ ุงูพ ฺฉู ฺูุงู ฺฉ ู ุขูพ ฺฉู Firebase Console ูฺบ  project ฺฉููฺฏุฑ ฺฉุฑูุง ูฺฏุง</p>
  </main>

<script type="module">
import './firebase.js';
import { auth, db } from './firebase.js';
import { createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
import { ref, set, get } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

// elements
const loginEmail = document.getElementById('loginEmail');
const loginPassword = document.getElementById('loginPassword');
const loginBtn = document.getElementById('loginBtn');
const toSignup = document.getElementById('toSignup');
const signupEmail = document.getElementById('signupEmail');
const signupPassword = document.getElementById('signupPassword');
const signupBtn = document.getElementById('signupBtn');

toSignup.onclick = ()=> window.scrollTo({ top: 400, behavior:'smooth' });

signupBtn.onclick = async ()=>{
  const email = signupEmail.value.trim(), pass = signupPassword.value.trim();
  if(!email||!pass) return alert('ุง ูู ุงูุฑ ูพุงุณ ูุฑฺ ุฏุฑุฌ ฺฉุฑฺบ');
  try{
    const res = await createUserWithEmailAndPassword(auth, email, pass);
    await set(ref(db, 'users/' + res.user.uid), { email: res.user.email, balance: 0, createdAt: Date.now() });
    alert('ุณุงุฆู ุงูพ ฺฉุงูุงุจ โ ุจุฑุง ฺฉุฑู ูุงฺฏ ุงูู ฺฉุฑฺบ'); window.location.href = 'index.html';
  }catch(err){ alert(err.message); }
};

loginBtn.onclick = async ()=>{
  const email = loginEmail.value.trim(), pass = loginPassword.value.trim();
  if(!email||!pass) return alert('ุง ูู ุงูุฑ ูพุงุณ ูุฑฺ ุฏุฑุฌ ฺฉุฑฺบ');
  try{
    const res = await signInWithEmailAndPassword(auth, email, pass);
    const uid = res.user.uid;
    const ADMIN_UID = 'REPLACE_WITH_ADMIN_UID';
    if(uid === ADMIN_UID) window.location.href = 'admin.html';
    else window.location.href = 'user.html';
  }catch(err){ alert(err.message); }
};

onAuthStateChanged(auth, user=>{ if(user){ const ADMIN_UID='REPLACE_WITH_ADMIN_UID'; if(user.uid===ADMIN_UID) window.location.href='admin.html'; else window.location.href='user.html'; } });
</script>
</body>
</html>